<div class="flex items-center justify-between">
  <div>
    <h2 class="text-xl font-semibold text-slate-900">Profit Dashboard</h2>
    <div class="mt-1 text-xs text-slate-500">Is my shop making money today or not?</div>
  </div>

  <form class="flex items-center gap-2" [formGroup]="selectedDateForm" (ngSubmit)="load()">
    <input class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm" type="date" formControlName="date" />
    <button
      type="button"
      class="rounded-xl bg-indigo-950 px-3 py-2 text-xs font-semibold text-white disabled:cursor-not-allowed disabled:opacity-70"
      (click)="load()"
      [disabled]="loading()"
    >
      Refresh
    </button>
  </form>
</div>

<div class="mt-3 text-sm text-red-700" *ngIf="error()">{{ error() }}</div>

<div class="mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
  <div class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100">
    <div class="text-xs font-semibold text-slate-500">Today Sales</div>
    <div class="mt-1 text-2xl font-extrabold text-slate-900">{{ todaySales() }}</div>
  </div>

  <div class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100">
    <div class="text-xs font-semibold text-slate-500">Gross Profit</div>
    <div class="mt-1 text-2xl font-extrabold text-slate-900">{{ grossProfit() }}</div>
    <div class="mt-1 text-xs text-slate-500">(From stock movements)</div>
  </div>

  <div class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100">
    <div class="text-xs font-semibold text-slate-500">Expenses Today</div>
    <div class="mt-1 text-2xl font-extrabold text-slate-900">{{ expensesToday() }}</div>
  </div>

  <div class="rounded-2xl p-4 shadow-sm ring-1" [ngClass]="netProfitIsPositive() ? 'bg-emerald-50 ring-emerald-200' : 'bg-red-50 ring-red-200'">
    <div class="text-xs font-semibold" [ngClass]="netProfitIsPositive() ? 'text-emerald-700' : 'text-red-700'">Net Profit</div>
    <div class="mt-1 text-2xl font-extrabold" [ngClass]="netProfitIsPositive() ? 'text-emerald-800' : 'text-red-800'">
      {{ netProfit() }}
    </div>
    <div class="mt-1 text-xs" [ngClass]="netProfitIsPositive() ? 'text-emerald-700' : 'text-red-700'">
      {{ netProfitIsPositive() ? 'Profit (positive)' : 'Loss (negative)' }}
    </div>
  </div>
</div>

<div class="mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2">
  <section class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100 lg:col-span-2">
    <div class="flex items-center justify-between">
      <h3 class="text-base font-semibold text-slate-900">Last 7 Days Profit</h3>
    </div>
    <div class="mt-3">
      <canvas baseChart [type]="'line'" [data]="lineChartData()" [options]="lineChartOptions"></canvas>
    </div>
  </section>

  <section class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100">
    <div class="flex items-center justify-between">
      <h3 class="text-base font-semibold text-slate-900">Top Selling Products</h3>
    </div>
    <div class="mt-3">
      <canvas baseChart [type]="'bar'" [data]="barChartData()" [options]="barChartOptions"></canvas>
    </div>
  </section>

  <section class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-100">
    <div class="flex items-center justify-between">
      <h3 class="text-base font-semibold text-slate-900">Expense Breakdown</h3>
    </div>
    <div class="mt-3">
      <canvas baseChart [type]="'pie'" [data]="pieChartData()" [options]="pieChartOptions"></canvas>
    </div>
  </section>
</div>
