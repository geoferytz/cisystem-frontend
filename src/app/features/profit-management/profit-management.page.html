<div class="space-y-4">
  <div class="flex flex-wrap items-end justify-between gap-3">
    <div>
      <div class="text-xl font-bold text-slate-900">Profit Management</div>
      <div class="text-sm text-slate-500">Net profit = gross profit - expenses</div>
    </div>

    <button
      type="button"
      class="rounded-xl bg-indigo-950 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-900 disabled:cursor-not-allowed disabled:opacity-70"
      (click)="load()"
      [disabled]="loading()"
    >
      Search
    </button>
  </div>

  <form class="grid grid-cols-1 gap-3 rounded-2xl bg-white p-4 ring-1 ring-slate-200 md:grid-cols-4">
    <label class="grid gap-2 text-xs text-slate-700">
      Mode
      <select class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm" [formControl]="$any(form.controls.mode)">
        <option value="DAY">Day</option>
        <option value="MONTH">Month</option>
        <option value="YEAR">Year</option>
      </select>
    </label>

    <label class="grid gap-2 text-xs text-slate-700" *ngIf="form.getRawValue().mode === 'DAY'">
      Date
      <input type="date" class="rounded-xl border border-slate-200 px-3 py-2 text-sm" [formControl]="$any(form.controls.date)" />
    </label>

    <label class="grid gap-2 text-xs text-slate-700" *ngIf="form.getRawValue().mode !== 'DAY'">
      Year
      <input type="number" class="rounded-xl border border-slate-200 px-3 py-2 text-sm" [formControl]="$any(form.controls.year)" />
    </label>

    <label class="grid gap-2 text-xs text-slate-700" *ngIf="form.getRawValue().mode === 'MONTH'">
      Month (1-12)
      <input type="number" min="1" max="12" class="rounded-xl border border-slate-200 px-3 py-2 text-sm" [formControl]="$any(form.controls.month)" />
    </label>
  </form>

  <div *ngIf="error()" class="rounded-2xl bg-red-50 p-4 text-sm text-red-700 ring-1 ring-red-200">
    {{ error() }}
  </div>

  <div class="grid grid-cols-1 gap-3 md:grid-cols-3">
    <div class="rounded-2xl bg-white p-4 ring-1 ring-slate-200">
      <div class="text-xs text-slate-500">Gross Profit</div>
      <div class="mt-1 text-2xl font-extrabold text-slate-900">{{ totalGrossProfit() | money }}</div>
    </div>
    <div class="rounded-2xl bg-white p-4 ring-1 ring-slate-200">
      <div class="text-xs text-slate-500">Expenses</div>
      <div class="mt-1 text-2xl font-extrabold text-slate-900">{{ totalExpenses() | money }}</div>
    </div>
    <div class="rounded-2xl bg-white p-4 ring-1 ring-slate-200">
      <div class="text-xs text-slate-500">Net Profit</div>
      <div
        class="mt-1 text-2xl font-extrabold"
        [ngClass]="netProfitIsPositive() ? 'text-emerald-700' : 'text-red-700'"
      >
        {{ totalNetProfit() | money }}
      </div>
    </div>
  </div>

  <div class="overflow-x-auto rounded-2xl bg-white ring-1 ring-slate-200">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-50 text-left text-xs text-slate-500">
        <tr>
          <th class="px-4 py-3">Period</th>
          <th class="px-4 py-3">Gross Profit</th>
          <th class="px-4 py-3">Expenses</th>
          <th class="px-4 py-3">Net Profit</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="loading()">
          <td class="px-4 py-4 text-slate-500" colspan="4">Loading...</td>
        </tr>
        <tr *ngIf="!loading() && rows().length === 0">
          <td class="px-4 py-4 text-slate-500" colspan="4">No data</td>
        </tr>
        <tr *ngFor="let r of rows()" class="border-t border-slate-100">
          <td class="px-4 py-3 font-medium text-slate-900">{{ r.label }}</td>
          <td class="px-4 py-3">{{ r.grossProfit | money }}</td>
          <td class="px-4 py-3">{{ r.expenses | money }}</td>
          <td class="px-4 py-3" [ngClass]="r.netProfit >= 0 ? 'text-emerald-700' : 'text-red-700'">{{ r.netProfit | money }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
