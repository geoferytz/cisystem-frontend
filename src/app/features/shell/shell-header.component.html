<header class="relative z-40 mb-4 flex items-center gap-3">
  <button
    *ngIf="showSidebarToggle"
    type="button"
    (click)="$event.stopPropagation(); onToggleSidebar()"
    class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-white text-slate-700 shadow-sm ring-1 ring-slate-200 hover:bg-slate-50"
    aria-label="Toggle navigation"
  >
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>

  <div class="ml-auto flex items-center justify-end gap-3">
    <div class="relative" (click)="$event.stopPropagation()">
      <button
        type="button"
        (click)="onToggleNotifications()"
        class="relative inline-flex h-10 w-10 items-center justify-center rounded-xl bg-white text-slate-700 shadow-sm ring-1 ring-slate-200 hover:bg-slate-50"
        aria-label="Notifications"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0a3 3 0 11-6 0m6 0H9"
          />
        </svg>

        <span
          *ngIf="notificationsCount > 0"
          class="absolute -right-1 -top-1 inline-flex min-w-[18px] items-center justify-center rounded-full bg-red-600 px-1.5 py-0.5 text-[10px] font-bold leading-none text-white"
        >
          {{ notificationsCount }}
        </span>
      </button>

      <div
        *ngIf="notificationsOpen"
        class="absolute right-0 z-50 mt-2 w-80 rounded-2xl bg-white p-3 shadow-lg ring-1 ring-slate-200"
      >
        <div class="text-sm font-semibold text-slate-900">Notifications</div>
        <div class="mt-1 text-xs text-slate-600">
          Expiry (30 days) + Low stock (threshold 10)
        </div>
        <div class="mt-3 rounded-xl bg-slate-50 p-3 text-sm text-slate-700">
          Total: <span class="font-semibold">{{ notificationsCount }}</span>
        </div>
        <a
          routerLink="/expiry-alerts"
          class="mt-3 block rounded-xl bg-indigo-950 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-purple-900"
          (click)="onCloseMenus()"
          >View Alerts</a>
      </div>
    </div>

    <div class="relative" (click)="$event.stopPropagation()">
      <button
        type="button"
        (click)="onToggleUserMenu()"
        class="inline-flex items-center gap-3 rounded-xl bg-white px-3 py-2 text-left shadow-sm ring-1 ring-slate-200 hover:bg-slate-50"
      >
        <div class="flex h-9 w-9 items-center justify-center rounded-xl bg-indigo-950 text-sm font-bold text-white">
          {{ (user?.name?.slice(0, 1) || 'U') }}
        </div>
        <div class="hidden sm:block">
          <div class="text-sm font-semibold text-slate-900">
            {{ user?.name || 'User' }}
          </div>
          <div class="text-xs text-slate-600">{{ user?.email || '' }}</div>
        </div>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-slate-500">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <div
        *ngIf="userMenuOpen"
        class="absolute right-0 z-50 mt-2 w-64 rounded-2xl bg-white p-2 shadow-lg ring-1 ring-slate-200"
      >
        <div class="px-3 py-2">
          <div class="text-sm font-semibold text-slate-900">{{ user?.name || 'User' }}</div>
          <div class="text-xs text-slate-600">{{ user?.email || '' }}</div>
        </div>
        <div class="my-1 h-px bg-slate-100"></div>

        <button
          type="button"
          class="flex w-full items-center gap-2 rounded-xl px-3 py-2 text-left text-sm font-semibold text-slate-700 hover:bg-slate-50"
          (click)="onCloseMenus(); onChangePassword()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-slate-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 19v-1a6 6 0 0112 0v1" />
          </svg>
          Change Password
        </button>

        <button
          *ngIf="user?.roles?.includes('ADMIN')"
          type="button"
          class="flex w-full items-center gap-2 rounded-xl px-3 py-2 text-left text-sm font-semibold text-slate-700 hover:bg-slate-50"
          (click)="onCloseMenus(); onResetUserPassword()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-slate-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v4" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 14h.01" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
          </svg>
          Reset User Password
        </button>

        <button
          type="button"
          class="flex w-full items-center gap-2 rounded-xl px-3 py-2 text-left text-sm font-semibold text-slate-700 hover:bg-slate-50"
          (click)="onCloseMenus(); onLogout()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-slate-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 16l4-4-4-4" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M14 12H3" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 19V5a2 2 0 00-2-2h-6" />
          </svg>
          Logout
        </button>
      </div>
    </div>
  </div>
</header>
